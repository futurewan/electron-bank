# æ•°æ®å­˜å‚¨ä¸ AI é›†æˆæ–¹æ¡ˆææ¡ˆ

## ğŸ“Œ æ–¹æ¡ˆæ¦‚è¿°

æœ¬ææ¡ˆé‡‡ç”¨ **çº¯æœ¬åœ°æ¶æ„**ï¼Œæ‰€æœ‰æ•°æ®å­˜å‚¨å’Œ AI è°ƒç”¨å‡åœ¨ Electron åº”ç”¨å†…å®Œæˆï¼Œæ— éœ€åç«¯æœåŠ¡ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·ç”µè„‘ï¼ˆå®Œå…¨ç¦»çº¿å¯ç”¨ï¼‰                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Electron å¯¹è´¦åŠ©æ‰‹                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚   æ¸²æŸ“è¿›ç¨‹       â”‚  IPC   â”‚      ä¸»è¿›ç¨‹             â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   (React UI)    â”‚ â†â”€â”€â”€â”€â†’ â”‚   (Node.js åç«¯é€»è¾‘)   â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                        â”‚                  â”‚  â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚              â”‚                         â†“              â”‚   â”‚  â”‚
â”‚  â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”‚
â”‚  â”‚              â”‚  â”‚  ğŸ“ æœ¬åœ°å­˜å‚¨å±‚                    â”‚  â”‚   â”‚  â”‚
â”‚  â”‚              â”‚  â”‚  â”œâ”€ SQLite æ•°æ®åº“ (app.db)       â”‚  â”‚   â”‚  â”‚
â”‚  â”‚              â”‚  â”‚  â”œâ”€ é…ç½®æ–‡ä»¶ (electron-store)     â”‚  â”‚   â”‚  â”‚
â”‚  â”‚              â”‚  â”‚  â””â”€ æ–‡ä»¶ç³»ç»Ÿ (å¯¼å…¥/å¯¼å‡ºæ–‡ä»¶)      â”‚  â”‚   â”‚  â”‚
â”‚  â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  â”‚
â”‚  â”‚              â”‚                         â†“              â”‚   â”‚  â”‚
â”‚  â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”‚
â”‚  â”‚              â”‚  â”‚  ğŸ¤– AI è°ƒç”¨å±‚                     â”‚  â”‚   â”‚  â”‚
â”‚  â”‚              â”‚  â”‚  â”œâ”€ ç”¨æˆ·è‡ªå·±çš„ API Key (åŠ å¯†å­˜å‚¨) â”‚  â”‚   â”‚  â”‚
â”‚  â”‚              â”‚  â”‚  â””â”€ ç›´è¿ç¬¬ä¸‰æ–¹å¤§æ¨¡å‹ API          â”‚  â”‚   â”‚  â”‚
â”‚  â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â†“ HTTPS                           â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚                  â”‚  ç¬¬ä¸‰æ–¹å¤§æ¨¡å‹ API            â”‚                â”‚
â”‚                  â”‚  OpenAI / Claude / å…¶ä»–     â”‚                â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1. èƒŒæ™¯ä¸éœ€æ±‚

### 1.1 å½“å‰çŠ¶å†µ
- é¡¹ç›®ä½¿ç”¨ Electron + React + TypeScript æŠ€æœ¯æ ˆ
- ç›®å‰ä»…ä½¿ç”¨ Zustand è¿›è¡Œå†…å­˜çŠ¶æ€ç®¡ç†
- **ç¼ºå°‘æŒä¹…åŒ–å­˜å‚¨æ–¹æ¡ˆ**ï¼Œåº”ç”¨é‡å¯åæ•°æ®ä¸¢å¤±
- **ç¼ºå°‘ AI é›†æˆæ–¹æ¡ˆ**ï¼Œæ— æ³•è°ƒç”¨å¤§æ¨¡å‹è¿›è¡Œæ™ºèƒ½å¯¹è´¦

### 1.2 æ ¸å¿ƒéœ€æ±‚
1. **ä¸šåŠ¡æ•°æ®æŒä¹…åŒ–**ï¼šå¯¹è´¦è®°å½•ã€è´¦å•ã€äº¤æ˜“æ˜ç»†ç­‰ç»“æ„åŒ–æ•°æ®
2. **é…ç½®å­˜å‚¨**ï¼šåº”ç”¨é…ç½®ã€ç”¨æˆ·åå¥½è®¾ç½®ã€AI API Key
3. **æ–‡ä»¶ç®¡ç†**ï¼šå¯¼å…¥çš„ Excel/CSV æ–‡ä»¶ã€ç”Ÿæˆçš„å¯¹è´¦æŠ¥å‘Š
4. **AI èƒ½åŠ›é›†æˆ**ï¼šè°ƒç”¨å¤§æ¨¡å‹è¿›è¡Œæ™ºèƒ½å¯¹è´¦åˆ†æ
5. **æ€§èƒ½è¦æ±‚**ï¼šå¿«é€ŸæŸ¥è¯¢ã€æ”¯æŒå¤æ‚ç­›é€‰å’Œç»Ÿè®¡
6. **æ•°æ®å®‰å…¨**ï¼šæœ¬åœ°åŠ å¯†å­˜å‚¨ï¼ŒAPI Key å®‰å…¨ä¿æŠ¤
7. **è·¨å¹³å°å…¼å®¹**ï¼šWindowsã€macOSã€Linux ç»Ÿä¸€æ–¹æ¡ˆ

### 1.3 è®¾è®¡åŸåˆ™
- âœ… **çº¯æœ¬åœ°æ¶æ„**ï¼šæ— éœ€åç«¯æœåŠ¡ï¼Œé™ä½éƒ¨ç½²å¤æ‚åº¦
- âœ… **ç¦»çº¿ä¼˜å…ˆ**ï¼šæ ¸å¿ƒåŠŸèƒ½ç¦»çº¿å¯ç”¨ï¼ŒAI åŠŸèƒ½éœ€è”ç½‘
- âœ… **ç”¨æˆ·è‡ªä¸»**ï¼šç”¨æˆ·ä½¿ç”¨è‡ªå·±çš„ API Keyï¼Œæ•°æ®éšç§æœ‰ä¿éšœ
- âœ… **æ¸è¿›å¢å¼º**ï¼šå…ˆå®ç°åŸºç¡€å­˜å‚¨ï¼Œå†é›†æˆ AI èƒ½åŠ›

---

## 2. æŠ€æœ¯æ–¹æ¡ˆ

### 2.1 æ•°æ®å±‚ï¼šSQLite + Drizzle ORMï¼ˆæœ¬åœ°æ•°æ®åº“ï¼‰

#### æ ¸å¿ƒç‰¹æ€§
| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **å­˜å‚¨ä½ç½®** | ç”¨æˆ·ç”µè„‘æœ¬åœ°æ–‡ä»¶ (`~/AppData/electron-bank/app.db`) |
| **æ•°æ®åº“ç±»å‹** | SQLiteï¼ˆå•æ–‡ä»¶åµŒå…¥å¼æ•°æ®åº“ï¼‰ |
| **ORM æ¡†æ¶** | Drizzle ORMï¼ˆç±»å‹å®‰å…¨ï¼‰ |
| **è¿è¡Œç¯å¢ƒ** | Electron ä¸»è¿›ç¨‹ï¼ˆNode.jsï¼‰ |
| **ç½‘ç»œä¾èµ–** | âŒ æ— éœ€ç½‘ç»œï¼Œå®Œå…¨ç¦»çº¿ |

#### æŠ€æœ¯æ ˆ
```typescript
// æ ¸å¿ƒä¾èµ–
better-sqlite3      // SQLite é©±åŠ¨ï¼ˆåŒæ­¥ APIï¼Œæ€§èƒ½æ›´å¥½ï¼‰
drizzle-orm         // ç±»å‹å®‰å…¨çš„ ORM
drizzle-kit         // Schema è¿ç§»å·¥å…·
```

#### é€‚ç”¨åœºæ™¯
- âœ… å¯¹è´¦è®°å½•ï¼ˆéœ€è¦å¤æ‚æŸ¥è¯¢å’Œç»Ÿè®¡ï¼‰
- âœ… è´¦å•æ•°æ®ï¼ˆå…³è”æŸ¥è¯¢ï¼‰
- âœ… äº¤æ˜“æ˜ç»†ï¼ˆå¤§é‡æ•°æ®ï¼‰
- âœ… AI å¯¹è¯å†å²ï¼ˆéœ€è¦æŒä¹…åŒ–ï¼‰

---

### 2.2 é…ç½®å±‚ï¼šelectron-storeï¼ˆæœ¬åœ°é…ç½®ï¼‰

#### æ ¸å¿ƒç‰¹æ€§
| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **å­˜å‚¨æ ¼å¼** | JSON æ–‡ä»¶ |
| **åŠ å¯†æ”¯æŒ** | âœ… å†…ç½®åŠ å¯†ï¼ˆç”¨äºå­˜å‚¨ API Keyï¼‰ |
| **è‡ªåŠ¨æŒä¹…åŒ–** | âœ… æ— éœ€æ‰‹åŠ¨ä¿å­˜ |
| **Schema éªŒè¯** | âœ… æ”¯æŒ JSON Schema |

#### æŠ€æœ¯æ ˆ
```typescript
electron-store      // é…ç½®æŒä¹…åŒ–
```

#### é€‚ç”¨åœºæ™¯
- âœ… åº”ç”¨é…ç½®ï¼ˆçª—å£å¤§å°ã€ä¸»é¢˜ã€è¯­è¨€ï¼‰
- âœ… ç”¨æˆ·åå¥½ï¼ˆä¾§è¾¹æ çŠ¶æ€ã€é»˜è®¤ç­›é€‰æ¡ä»¶ï¼‰
- âœ… **AI API Key**ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
- âœ… AI æ¨¡å‹é…ç½®ï¼ˆæ¨¡å‹é€‰æ‹©ã€å‚æ•°è®¾ç½®ï¼‰

---

### 2.3 AI å±‚ï¼šä¸»è¿›ç¨‹ç›´æ¥è°ƒç”¨ç¬¬ä¸‰æ–¹ API

#### æ ¸å¿ƒç‰¹æ€§
| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **è°ƒç”¨ä½ç½®** | Electron ä¸»è¿›ç¨‹ï¼ˆNode.jsï¼‰ |
| **API Key å­˜å‚¨** | electron-store åŠ å¯†å­˜å‚¨ |
| **æ”¯æŒæ¨¡å‹** | OpenAI GPT / Anthropic Claude / å…¶ä»– |
| **ç½‘ç»œä¾èµ–** | âœ… éœ€è¦è”ç½‘ |
| **åç«¯æœåŠ¡** | âŒ ä¸éœ€è¦ï¼Œç›´è¿ç¬¬ä¸‰æ–¹ API |

#### ä¸ºä»€ä¹ˆé€‰æ‹©ä¸»è¿›ç¨‹ç›´è¿ï¼Ÿ

```
âœ… ä¼˜åŠ¿ï¼š
â”œâ”€ æ¶æ„ç®€å•ï¼Œæ— éœ€ç»´æŠ¤åç«¯æœåŠ¡
â”œâ”€ éƒ¨ç½²ç®€å•ï¼Œåªæœ‰ä¸€ä¸ªæ¡Œé¢åº”ç”¨
â”œâ”€ ç”¨æˆ·æ•°æ®ä¸ç»è¿‡ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ï¼ˆé™¤ AI æ¨¡å‹ï¼‰
â”œâ”€ ç”¨æˆ·å¯æ§ï¼Œä½¿ç”¨è‡ªå·±çš„ API Key
â””â”€ æˆæœ¬é€æ˜ï¼Œç”¨å¤šå°‘ä»˜å¤šå°‘

âš ï¸ æ³¨æ„äº‹é¡¹ï¼š
â”œâ”€ API Key éœ€è¦åŠ å¯†å­˜å‚¨
â”œâ”€ éœ€è¦å¤„ç†ç½‘ç»œé”™è¯¯
â””â”€ éœ€è¦å®ç°è¯·æ±‚é™æµ
```

#### æŠ€æœ¯æ ˆ
```typescript
// AI è°ƒç”¨ä¾èµ–
openai              // OpenAI å®˜æ–¹ SDK
@anthropic-ai/sdk   // Claude å®˜æ–¹ SDKï¼ˆå¯é€‰ï¼‰
```

---

## 3. ç³»ç»Ÿæ¶æ„

### 3.1 æ•°æ®åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¸²æŸ“è¿›ç¨‹ (React)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Zustand Store (å†…å­˜çŠ¶æ€)                                    â”‚
â”‚  â”œâ”€ UI çŠ¶æ€ (sidebarCollapsed, loading)                     â”‚
â”‚  â”œâ”€ ä¸´æ—¶æ•°æ® (è¡¨å•è¾“å…¥ã€ç­›é€‰æ¡ä»¶)                             â”‚
â”‚  â””â”€ AI ä¼šè¯çŠ¶æ€ (å½“å‰å¯¹è¯æ¶ˆæ¯)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†• IPC é€šä¿¡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸»è¿›ç¨‹ (Electron Node.js)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ã€æ•°æ®å±‚ã€‘SQLite + Drizzle ORM (æœ¬åœ°æ•°æ®åº“)                  â”‚
â”‚  â”œâ”€ å¯¹è´¦è®°å½• (reconciliation_records)                       â”‚
â”‚  â”œâ”€ è´¦å•æ•°æ® (bills)                                        â”‚
â”‚  â”œâ”€ äº¤æ˜“æ˜ç»† (transactions)                                 â”‚
â”‚  â””â”€ AI å¯¹è¯å†å² (ai_conversations)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ã€é…ç½®å±‚ã€‘electron-store (æœ¬åœ°é…ç½®)                          â”‚
â”‚  â”œâ”€ åº”ç”¨é…ç½® (theme, language, window)                      â”‚
â”‚  â”œâ”€ ç”¨æˆ·åå¥½ (sidebar, filters)                             â”‚
â”‚  â””â”€ AI é…ç½® (apiKey åŠ å¯†, model, temperature)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ã€æ–‡ä»¶å±‚ã€‘Node.js fs (æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ)                          â”‚
â”‚  â”œâ”€ å¯¼å…¥æ–‡ä»¶ (imports/)                                     â”‚
â”‚  â”œâ”€ å¯¼å‡ºæŠ¥å‘Š (exports/)                                     â”‚
â”‚  â””â”€ æ—¥å¿—æ–‡ä»¶ (logs/)                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ã€AI å±‚ã€‘OpenAI/Claude SDK (ç›´è¿ç¬¬ä¸‰æ–¹)                     â”‚
â”‚  â”œâ”€ æ™ºèƒ½å¯¹è´¦åˆ†æ                                            â”‚
â”‚  â”œâ”€ å¼‚å¸¸è¯†åˆ«                                                â”‚
â”‚  â””â”€ æŠ¥å‘Šç”Ÿæˆ                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æœ¬åœ°å­˜å‚¨è·¯å¾„

```typescript
// æ•°æ®ç›®å½•ç»“æ„ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
~/Library/Application Support/electron-bank/  (macOS)
%APPDATA%/electron-bank/                      (Windows)
~/.config/electron-bank/                      (Linux)

â”œâ”€â”€ database/
â”‚   â””â”€â”€ app.db                    # SQLite æœ¬åœ°æ•°æ®åº“
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ config.json               # åº”ç”¨é…ç½®ï¼ˆåŠ å¯†ï¼‰
â”‚   â””â”€â”€ ai.json                   # AI é…ç½®ï¼ˆAPI Key åŠ å¯†ï¼‰
â”œâ”€â”€ imports/                      # å¯¼å…¥çš„åŸå§‹æ–‡ä»¶
â”‚   â”œâ”€â”€ 2024-01/
â”‚   â””â”€â”€ 2024-02/
â”œâ”€â”€ exports/                      # å¯¼å‡ºçš„æŠ¥å‘Šæ–‡ä»¶
â”‚   â”œâ”€â”€ reconciliation-2024-01.xlsx
â”‚   â””â”€â”€ report-2024-02.pdf
â””â”€â”€ logs/                         # åº”ç”¨æ—¥å¿—
    â””â”€â”€ app.log
```

---

## 4. æ•°æ®åº“ Schema è®¾è®¡

### 4.1 æ ¸å¿ƒè¡¨ç»“æ„

```typescript
// electron/database/schema.ts
import { sqliteTable, text, integer, real } from 'drizzle-orm/sqlite-core'

// å¯¹è´¦è®°å½•è¡¨
export const reconciliationRecords = sqliteTable('reconciliation_records', {
  id: text('id').primaryKey(),
  billNumber: text('bill_number').notNull(),
  amount: real('amount').notNull(),
  status: text('status').notNull(),     // 'pending' | 'matched' | 'unmatched'
  aiAnalysis: text('ai_analysis'),       // AI åˆ†æç»“æœï¼ˆJSONï¼‰
  createdAt: integer('created_at', { mode: 'timestamp' }).notNull(),
  updatedAt: integer('updated_at', { mode: 'timestamp' }).notNull(),
})

// è´¦å•æ•°æ®è¡¨
export const bills = sqliteTable('bills', {
  id: text('id').primaryKey(),
  recordId: text('record_id').references(() => reconciliationRecords.id),
  type: text('type').notNull(),          // 'income' | 'expense'
  amount: real('amount').notNull(),
  date: integer('date', { mode: 'timestamp' }).notNull(),
  description: text('description'),
  source: text('source'),                // æ•°æ®æ¥æº
})

// AI å¯¹è¯å†å²è¡¨
export const aiConversations = sqliteTable('ai_conversations', {
  id: text('id').primaryKey(),
  recordId: text('record_id').references(() => reconciliationRecords.id),
  role: text('role').notNull(),          // 'user' | 'assistant'
  content: text('content').notNull(),
  model: text('model'),                  // ä½¿ç”¨çš„æ¨¡å‹
  tokenCount: integer('token_count'),    // Token æ¶ˆè€—
  createdAt: integer('created_at', { mode: 'timestamp' }).notNull(),
})
```

---

## 5. AI é›†æˆæ–¹æ¡ˆ

### 5.1 API Key å®‰å…¨å­˜å‚¨

```typescript
// electron/config/aiStore.ts
import Store from 'electron-store'
import { safeStorage } from 'electron'

interface AIConfig {
  provider: 'openai' | 'anthropic' | 'custom'
  model: string
  temperature: number
  maxTokens: number
}

// API Key ä½¿ç”¨ Electron çš„ safeStorage åŠ å¯†
export class AIKeyManager {
  private store = new Store({ name: 'ai-config' })
  
  // å®‰å…¨å­˜å‚¨ API Key
  setApiKey(provider: string, apiKey: string): void {
    const encrypted = safeStorage.encryptString(apiKey)
    this.store.set(`keys.${provider}`, encrypted.toString('base64'))
  }
  
  // å®‰å…¨è¯»å– API Key
  getApiKey(provider: string): string | null {
    const encrypted = this.store.get(`keys.${provider}`) as string
    if (!encrypted) return null
    const buffer = Buffer.from(encrypted, 'base64')
    return safeStorage.decryptString(buffer)
  }
  
  // æ¸…é™¤ API Key
  clearApiKey(provider: string): void {
    this.store.delete(`keys.${provider}`)
  }
}
```

### 5.2 AI æœåŠ¡å°è£…

```typescript
// electron/services/aiService.ts
import OpenAI from 'openai'
import { AIKeyManager } from '../config/aiStore'

export class AIService {
  private keyManager = new AIKeyManager()
  private client: OpenAI | null = null
  
  // åˆå§‹åŒ– AI å®¢æˆ·ç«¯
  private getClient(): OpenAI {
    if (!this.client) {
      const apiKey = this.keyManager.getApiKey('openai')
      if (!apiKey) {
        throw new Error('è¯·å…ˆé…ç½® OpenAI API Key')
      }
      this.client = new OpenAI({ apiKey })
    }
    return this.client
  }
  
  // æ™ºèƒ½å¯¹è´¦åˆ†æ
  async analyzeReconciliation(data: ReconciliationData): Promise<AnalysisResult> {
    const client = this.getClient()
    
    const response = await client.chat.completions.create({
      model: 'gpt-4o-mini',
      messages: [
        {
          role: 'system',
          content: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å¯¹è´¦åˆ†æåŠ©æ‰‹ï¼Œå¸®åŠ©ç”¨æˆ·åˆ†æè´¦å•å·®å¼‚...'
        },
        {
          role: 'user',
          content: JSON.stringify(data)
        }
      ],
      temperature: 0.3,
      max_tokens: 2000,
    })
    
    return {
      analysis: response.choices[0].message.content,
      tokenUsage: response.usage,
    }
  }
  
  // å¼‚å¸¸æ£€æµ‹
  async detectAnomalies(transactions: Transaction[]): Promise<AnomalyResult[]> {
    // ... è°ƒç”¨å¤§æ¨¡å‹è¿›è¡Œå¼‚å¸¸æ£€æµ‹
  }
  
  // ç”Ÿæˆå¯¹è´¦æŠ¥å‘Š
  async generateReport(data: ReportData): Promise<string> {
    // ... è°ƒç”¨å¤§æ¨¡å‹ç”ŸæˆæŠ¥å‘Š
  }
}
```

### 5.3 IPC é€šé“è®¾è®¡

```typescript
// electron/ipc/channels.ts
export const IPC_CHANNELS = {
  // æ•°æ®åº“æ“ä½œ
  DB_QUERY: 'db:query',
  DB_INSERT: 'db:insert',
  DB_UPDATE: 'db:update',
  DB_DELETE: 'db:delete',
  
  // é…ç½®æ“ä½œ
  CONFIG_GET: 'config:get',
  CONFIG_SET: 'config:set',
  
  // æ–‡ä»¶æ“ä½œ
  FILE_IMPORT: 'file:import',
  FILE_EXPORT: 'file:export',
  
  // AI æ“ä½œ
  AI_SET_KEY: 'ai:setKey',
  AI_CHECK_KEY: 'ai:checkKey',
  AI_ANALYZE: 'ai:analyze',
  AI_DETECT_ANOMALIES: 'ai:detectAnomalies',
  AI_GENERATE_REPORT: 'ai:generateReport',
}
```

---

## 6. å®‰å…¨æ€§è®¾è®¡

### 6.1 API Key ä¿æŠ¤

| ä¿æŠ¤æªæ–½ | å®ç°æ–¹å¼ |
|----------|----------|
| **åŠ å¯†å­˜å‚¨** | ä½¿ç”¨ Electron `safeStorage` APIï¼ˆç³»ç»Ÿçº§åŠ å¯†ï¼‰ |
| **å†…å­˜ä¿æŠ¤** | API Key ä»…åœ¨ä¸»è¿›ç¨‹ä½¿ç”¨ï¼Œä¸ä¼ é€’åˆ°æ¸²æŸ“è¿›ç¨‹ |
| **æ˜¾ç¤ºæ©ç ** | UI æ˜¾ç¤ºä¸º `sk-****...****` |
| **å®‰å…¨åˆ é™¤** | æä¾›æ¸…é™¤ API Key åŠŸèƒ½ |

### 6.2 æ•°æ®å®‰å…¨

| ä¿æŠ¤æªæ–½ | å®ç°æ–¹å¼ |
|----------|----------|
| **æœ¬åœ°å­˜å‚¨** | æ•°æ®ä¸ä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ |
| **æ–‡ä»¶æƒé™** | æ•°æ®åº“æ–‡ä»¶ä»…å½“å‰ç”¨æˆ·å¯è¯»å†™ |
| **æ•æ„Ÿå­—æ®µ** | å¯é€‰ï¼šä½¿ç”¨åº”ç”¨å±‚åŠ å¯† |

---

## 7. å®æ–½è®¡åˆ’

### 7.1 Phase 1: æœ¬åœ°å­˜å‚¨åŸºç¡€ï¼ˆ3-4 å°æ—¶ï¼‰

| Task | æè¿° | æ—¶é—´ |
|------|------|------|
| 1.1 | å®‰è£…ä¾èµ– (better-sqlite3, drizzle-orm, electron-store) | 0.5h |
| 1.2 | åˆ›å»ºæ•°æ®åº“ Schema å’Œè¿æ¥ | 1h |
| 1.3 | é…ç½® electron-store | 0.5h |
| 1.4 | å®ç°æ–‡ä»¶ç®¡ç†å·¥å…· | 1h |
| 1.5 | æ•°æ®åº“è¿ç§»é…ç½® | 0.5h |

### 7.2 Phase 2: IPC é€šä¿¡å±‚ï¼ˆ2-3 å°æ—¶ï¼‰

| Task | æè¿° | æ—¶é—´ |
|------|------|------|
| 2.1 | å®šä¹‰ IPC é€šé“å¸¸é‡ | 0.5h |
| 2.2 | å®ç°æ•°æ®åº“ IPC å¤„ç†å™¨ | 1h |
| 2.3 | å®ç°é…ç½® IPC å¤„ç†å™¨ | 0.5h |
| 2.4 | æ›´æ–° preload.ts æš´éœ² API | 0.5h |
| 2.5 | åˆ›å»ºæ¸²æŸ“è¿›ç¨‹ç±»å‹å®šä¹‰ | 0.5h |

### 7.3 Phase 3: AI é›†æˆï¼ˆ2-3 å°æ—¶ï¼‰

| Task | æè¿° | æ—¶é—´ |
|------|------|------|
| 3.1 | å®ç° API Key å®‰å…¨å­˜å‚¨ | 0.5h |
| 3.2 | å°è£… AI æœåŠ¡ç±» | 1h |
| 3.3 | å®ç° AI IPC å¤„ç†å™¨ | 0.5h |
| 3.4 | åˆ›å»º AI é…ç½®ç•Œé¢ | 1h |

### 7.4 Phase 4: æ¸²æŸ“è¿›ç¨‹é›†æˆï¼ˆ2 å°æ—¶ï¼‰

| Task | æè¿° | æ—¶é—´ |
|------|------|------|
| 4.1 | åˆ›å»ºæ•°æ®æœåŠ¡å±‚ | 0.5h |
| 4.2 | åˆ›å»º AI æœåŠ¡å±‚ | 0.5h |
| 4.3 | æ›´æ–° Zustand Store | 0.5h |
| 4.4 | é›†æˆæµ‹è¯• | 0.5h |

### 7.5 æ—¶é—´æ€»è®¡

| é˜¶æ®µ | é¢„ä¼°æ—¶é—´ |
|------|----------|
| Phase 1: æœ¬åœ°å­˜å‚¨åŸºç¡€ | 3-4 å°æ—¶ |
| Phase 2: IPC é€šä¿¡å±‚ | 2-3 å°æ—¶ |
| Phase 3: AI é›†æˆ | 2-3 å°æ—¶ |
| Phase 4: æ¸²æŸ“è¿›ç¨‹é›†æˆ | 2 å°æ—¶ |
| **æ€»è®¡** | **9-12 å°æ—¶** |

---

## 8. æŠ€æœ¯æ ˆæ€»ç»“

### 8.1 æ–°å¢ä¾èµ–

```json
{
  "dependencies": {
    "better-sqlite3": "^11.0.0",
    "drizzle-orm": "^0.36.0",
    "electron-store": "^10.0.0",
    "openai": "^4.70.0"
  },
  "devDependencies": {
    "drizzle-kit": "^0.28.0",
    "@types/better-sqlite3": "^7.6.0"
  }
}
```

### 8.2 ç›®å½•ç»“æ„

```
electron/
â”œâ”€â”€ main.ts                     # ä¸»è¿›ç¨‹å…¥å£
â”œâ”€â”€ preload.ts                  # é¢„åŠ è½½è„šæœ¬
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ schema.ts               # æ•°æ®åº“ Schema
â”‚   â”œâ”€â”€ client.ts               # æ•°æ®åº“è¿æ¥
â”‚   â””â”€â”€ migrations/             # è¿ç§»æ–‡ä»¶
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ store.ts                # åº”ç”¨é…ç½®
â”‚   â””â”€â”€ aiStore.ts              # AI é…ç½®ï¼ˆåŠ å¯†ï¼‰
â”œâ”€â”€ services/
â”‚   â””â”€â”€ aiService.ts            # AI æœåŠ¡
â”œâ”€â”€ ipc/
â”‚   â”œâ”€â”€ channels.ts             # IPC é€šé“å®šä¹‰
â”‚   â””â”€â”€ handlers/
â”‚       â”œâ”€â”€ database.ts         # æ•°æ®åº“å¤„ç†å™¨
â”‚       â”œâ”€â”€ config.ts           # é…ç½®å¤„ç†å™¨
â”‚       â”œâ”€â”€ file.ts             # æ–‡ä»¶å¤„ç†å™¨
â”‚       â””â”€â”€ ai.ts               # AI å¤„ç†å™¨
â””â”€â”€ utils/
    â””â”€â”€ fileManager.ts          # æ–‡ä»¶ç®¡ç†å·¥å…·
```

---

## 9. é£é™©ä¸åº”å¯¹

| é£é™© | å½±å“ | åº”å¯¹æªæ–½ |
|------|------|----------|
| SQLite å¹¶å‘é™åˆ¶ | å¤šæ“ä½œå†²çª | ä½¿ç”¨äº‹åŠ¡ï¼Œé˜Ÿåˆ—åŒ–å†™æ“ä½œ |
| API Key æ³„éœ² | ç”¨æˆ·æŸå¤± | safeStorage åŠ å¯† + ä¸åœ¨æ—¥å¿—ä¸­è¾“å‡º |
| ç½‘ç»œä¸ç¨³å®š | AI åŠŸèƒ½ä¸å¯ç”¨ | ä¼˜é›…é™çº§ï¼Œæ˜¾ç¤ºé”™è¯¯æç¤º |
| è·¨å¹³å°è·¯å¾„å·®å¼‚ | æ–‡ä»¶æ‰¾ä¸åˆ° | ä½¿ç”¨ electron app.getPath() |
| å¤§æ¨¡å‹ API å˜æ›´ | åŠŸèƒ½å¤±æ•ˆ | å°è£…æŠ½è±¡å±‚ï¼Œä¾¿äºåˆ‡æ¢ |

---

## 10. å¾…ç¡®è®¤é—®é¢˜

1. **é»˜è®¤æ”¯æŒå“ªäº› AI æ¨¡å‹ï¼Ÿ**
   - [ ] OpenAI GPT-4o / GPT-4o-mini
   - [ ] Anthropic Claude
   - [ ] è‡ªå®šä¹‰ API ç«¯ç‚¹ï¼ˆå…¼å®¹ OpenAI æ ¼å¼ï¼‰

2. **æ˜¯å¦éœ€è¦ AI å¯¹è¯å†å²æŒä¹…åŒ–ï¼Ÿ**
   - [ ] ä»…ä¿å­˜å½“å‰ä¼šè¯
   - [ ] ä¿å­˜æ‰€æœ‰å†å²å¯¹è¯

3. **Token æ¶ˆè€—ç»Ÿè®¡æ˜¯å¦éœ€è¦ï¼Ÿ**
   - [ ] ä¸éœ€è¦
   - [ ] éœ€è¦ï¼Œæ˜¾ç¤ºåœ¨è®¾ç½®é¡µé¢

---

## 11. ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç¡®è®¤åç«‹å³æ‰§è¡Œï¼š
1. âœ… **æ›´æ–° `spec.md`**ï¼Œè¯¦ç»†å®šä¹‰æ•°æ®ç»“æ„å’Œ API
2. âœ… **æ›´æ–° `tasks.md`**ï¼Œæ‹†è§£åŸå­ä»»åŠ¡
3. âœ… **å¼€å§‹ Phase 1 å®æ–½**

---

**ææ¡ˆçŠ¶æ€**: ï¿½ å·²ç¡®è®¤ä½¿ç”¨æœ¬åœ°æ•°æ®åº“  
**åˆ›å»ºæ—¶é—´**: 2026-02-09  
**æ›´æ–°æ—¶é—´**: 2026-02-09  
**ä½œè€…**: Antigravity AI  
**ç‰ˆæœ¬**: v2.0
