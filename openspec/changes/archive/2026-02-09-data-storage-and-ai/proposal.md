# 数据存储与 AI 集成方案

## 概述

为 AI 对账助手添加本地数据持久化和 AI 智能分析能力，采用纯本地架构，无需后端服务。

## 背景

当前项目存在以下问题：
- 仅使用 Zustand 内存状态，应用重启后数据丢失
- 缺少 AI 集成能力，无法进行智能对账分析

## 目标

1. **数据持久化**：使用 SQLite 本地数据库存储业务数据
2. **配置管理**：使用 electron-store 存储应用配置和用户偏好
3. **AI 集成**：主进程直连第三方大模型 API（OpenAI/Claude）
4. **安全存储**：API Key 使用系统级加密保护

## 方案

### 架构设计

```
用户电脑
├── Electron 应用
│   ├── 渲染进程 (React UI) ←→ IPC ←→ 主进程 (Node.js)
│   │                                   ├── SQLite 本地数据库
│   │                                   ├── electron-store 配置
│   │                                   ├── 文件系统管理
│   │                                   └── AI 服务（直连第三方）
│   └── 本地存储目录
└── 第三方 AI API (需联网)
```

### 技术选型

| 功能 | 技术 | 说明 |
|------|------|------|
| 业务数据 | SQLite + Drizzle ORM | 类型安全的本地数据库 |
| 配置存储 | electron-store | JSON 格式，支持加密 |
| AI 调用 | OpenAI SDK | 直连，用户自己的 API Key |
| 文件管理 | Node.js fs | 导入/导出文件 |

## 非目标

- ❌ 不需要后端服务
- ❌ 不需要云同步
- ❌ 不需要多用户支持

## 风险

| 风险 | 应对 |
|------|------|
| API Key 泄露 | 使用 Electron safeStorage 加密 |
| 数据丢失 | 提供备份/恢复功能 |
| AI 服务不可用 | 优雅降级，核心功能离线可用 |

## 时间估算

总计 9-12 小时
