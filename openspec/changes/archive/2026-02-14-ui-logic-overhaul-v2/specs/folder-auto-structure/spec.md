## ADDED Requirements

### Requirement: 用户选择工作目录并自动初始化子文件夹结构
用户首次点击「开始对账」按钮时，系统 SHALL 弹窗提示用户选择一个本地文件夹作为工作目录。选择完成后，系统 SHALL 在该文件夹内自动创建以下 3 个子文件夹：
- `00归档`
- `01发票`
- `02银行流水`

如果子文件夹已存在，系统 SHALL 跳过创建，不覆盖已有内容。

#### Scenario: 首次使用 — 选择空文件夹
- **WHEN** 用户首次点击「开始对账」且未配置过工作目录
- **THEN** 系统弹出文件夹选择对话框
- **WHEN** 用户选择了一个本地文件夹
- **THEN** 系统在该文件夹内创建 `00归档`、`01发票`、`02银行流水` 三个子文件夹
- **THEN** 系统将该文件夹路径保存为 `workspaceFolder` 配置
- **THEN** 系统继续执行对账流程

#### Scenario: 首次使用 — 选择已有子文件夹的目录
- **WHEN** 用户选择的文件夹中已存在 `00归档`、`01发票`、`02银行流水` 中的部分或全部子文件夹
- **THEN** 系统仅创建缺失的子文件夹，不修改已存在的文件夹及其内容

#### Scenario: 用户取消选择
- **WHEN** 用户在文件夹选择对话框中点击取消
- **THEN** 系统不执行任何操作，返回首页，不启动对账流程

### Requirement: 已配置工作目录时直接开始对账
当用户已配置过工作目录且目录结构完整时，点击「开始对账」SHALL 直接自动抓取 `01发票` 和 `02银行流水` 文件夹内的数据进行比对，无需再次选择文件夹。

#### Scenario: 已配置 — 直接开始对账
- **WHEN** 用户已配置 `workspaceFolder` 且 `01发票` 和 `02银行流水` 文件夹存在
- **THEN** 系统自动扫描 `01发票` 文件夹获取发票文件
- **THEN** 系统自动扫描 `02银行流水` 文件夹获取银行流水文件
- **THEN** 系统使用扫描到的文件创建批次并启动对账流程

#### Scenario: 已配置 — 工作目录被删除
- **WHEN** 用户已配置 `workspaceFolder` 但该目录或其子目录不存在
- **THEN** 系统自动重建缺失的目录结构
- **THEN** 系统提示用户："工作目录已自动重建，请将银行流水和发票文件放入对应文件夹后再开始对账"
- **THEN** 系统不启动对账流程

### Requirement: 对账完成后自动创建归档子文件夹
每次对账完成后，系统 SHALL 在 `00归档` 文件夹内自动创建一个以 `YYYYMMDD-N` 格式命名的子文件夹，其中 `YYYYMMDD` 是当天日期，`N` 是当天的对账次序（从 1 开始递增）。

归档子文件夹内 SHALL 包含以下 3 个子文件夹：
- `发票` — 存放本次对账的发票文件
- `银行流水` — 存放本次对账的银行流水文件
- `AI比对报告` — 存放自动生成的对账报告

#### Scenario: 当天第一次对账归档
- **WHEN** 2026年2月15日完成第一次对账
- **WHEN** `00归档` 目录下不存在以 `20260215` 开头的文件夹
- **THEN** 系统创建 `00归档/20260215-1/` 文件夹
- **THEN** 系统在其中创建 `发票`、`银行流水`、`AI比对报告` 三个子文件夹

#### Scenario: 当天第二次对账归档
- **WHEN** 2026年2月15日完成第二次对账
- **WHEN** `00归档` 目录下已存在 `20260215-1` 文件夹
- **THEN** 系统创建 `00归档/20260215-2/` 文件夹
- **THEN** 系统在其中创建 `发票`、`银行流水`、`AI比对报告` 三个子文件夹

#### Scenario: 序号计算基于已有文件夹
- **WHEN** `00归档` 目录下存在 `20260215-1` 和 `20260215-3`（用户手动删除了 -2）
- **THEN** 系统创建 `00归档/20260215-4/` 文件夹（取最大序号 +1）

### Requirement: 对账完成后自动转存源文件到归档
对账完成后，系统 SHALL 自动将 `01发票` 和 `02银行流水` 文件夹中的源文件 **移动**（非复制）到 `00归档/{YYYYMMDD-N}/` 对应的子文件夹内。

#### Scenario: 正常转存
- **WHEN** 对账完成且归档子文件夹已创建
- **THEN** 系统将 `01发票` 中的所有文件移动到 `00归档/{YYYYMMDD-N}/发票/`
- **THEN** 系统将 `02银行流水` 中的所有文件移动到 `00归档/{YYYYMMDD-N}/银行流水/`
- **THEN** 移动完成后 `01发票` 和 `02银行流水` 目录为空

#### Scenario: 单个文件移动失败
- **WHEN** 某个文件因权限或锁定问题无法移动
- **THEN** 系统记录日志但不中断整体归档流程
- **THEN** 失败的文件保留在原位

### Requirement: 设置页面重置工作目录
用户 SHALL 能够在设置页面重新选择工作目录位置。

#### Scenario: 重置工作目录
- **WHEN** 用户在设置页面点击「重置工作目录」按钮
- **THEN** 系统弹出文件夹选择对话框
- **WHEN** 用户选择了新的文件夹
- **THEN** 系统在新文件夹内初始化子目录结构（`00归档`、`01发票`、`02银行流水`）
- **THEN** 系统更新 `workspaceFolder` 配置为新路径
- **THEN** 原工作目录及其内容不被删除或移动

### Requirement: 配置模型从多路径改为单根路径
系统 SHALL 将配置中的 `bankStatementFolder`、`invoiceFolder`、`archiveFolder` 三个独立路径替换为单一的 `workspaceFolder` 路径。子目录路径 SHALL 在运行时通过常量拼接动态计算：
- 发票路径 = `workspaceFolder/01发票`
- 银行流水路径 = `workspaceFolder/02银行流水`
- 归档路径 = `workspaceFolder/00归档`

#### Scenario: 配置迁移 — 旧配置存在
- **WHEN** 系统检测到旧格式配置（存在 `bankStatementFolder` 等字段但不存在 `workspaceFolder`）
- **THEN** 系统弹窗提示用户重新选择工作目录
- **THEN** 旧配置字段被忽略

#### Scenario: 子路径动态计算
- **WHEN** `workspaceFolder` 配置为 `/Users/abc/对账数据`
- **THEN** 发票路径解析为 `/Users/abc/对账数据/01发票`
- **THEN** 银行流水路径解析为 `/Users/abc/对账数据/02银行流水`
- **THEN** 归档路径解析为 `/Users/abc/对账数据/00归档`
