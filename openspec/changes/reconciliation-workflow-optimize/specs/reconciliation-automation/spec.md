# 规格说明：对账自动化

## ADDED Requirements

### Requirement: 文件夹配置管理

系统应提供银行流水文件夹、发票文件夹和归档文件夹的配置管理功能。配置项应持久化存储，用户可在设置中心随时修改。

#### Scenario: 首次配置银行流水文件夹
- **WHEN** 用户在设置中心点击「选择银行流水文件夹」
- **THEN** 系统弹出文件夹选择对话框
- **AND** 用户选择文件夹后，路径保存到 `bankStatementFolder` 配置项

#### Scenario: 首次配置发票文件夹
- **WHEN** 用户在设置中心点击「选择发票文件夹」
- **THEN** 系统弹出文件夹选择对话框
- **AND** 用户选择文件夹后，路径保存到 `invoiceFolder` 配置项

#### Scenario: 首次配置归档文件夹
- **WHEN** 用户在设置中心点击「选择归档文件夹」
- **THEN** 系统弹出文件夹选择对话框
- **AND** 用户选择文件夹后，路径保存到 `archiveFolder` 配置项

#### Scenario: 查看当前配置
- **WHEN** 用户打开设置中心的「对账文件夹」页面
- **THEN** 系统显示当前配置的三个文件夹路径
- **AND** 未配置的项显示「未设置」提示

---

### Requirement: 新建对账时自动检测文件夹配置

系统应在用户新建对账时自动检测文件夹配置状态，若未配置则引导用户设置。

#### Scenario: 未配置文件夹时新建对账
- **WHEN** 用户点击「新建对账」按钮
- **AND** `bankStatementFolder` 或 `invoiceFolder` 未配置
- **THEN** 系统弹出配置引导弹窗
- **AND** 弹窗包含银行流水文件夹和发票文件夹的选择按钮
- **AND** 用户完成配置后自动继续新建流程

#### Scenario: 已配置文件夹时新建对账
- **WHEN** 用户点击「新建对账」按钮
- **AND** `bankStatementFolder` 和 `invoiceFolder` 均已配置
- **THEN** 系统自动扫描两个文件夹中的 Excel 文件

---

### Requirement: 自动扫描并导入文件

系统应自动扫描配置的文件夹，列出可导入的文件供用户确认，确认后自动执行导入。

#### Scenario: 扫描文件夹并列出文件
- **WHEN** 系统执行文件夹扫描
- **THEN** 系统列出文件夹顶层的所有 `.xlsx` 和 `.xls` 文件
- **AND** 显示文件名、大小、修改时间

#### Scenario: 用户确认导入文件
- **WHEN** 系统显示扫描结果确认弹窗
- **AND** 用户点击「确认导入」
- **THEN** 系统自动导入银行流水文件到批次
- **AND** 系统自动导入发票文件到批次
- **AND** 导入完成后跳转到对账详情页

#### Scenario: 文件夹为空
- **WHEN** 系统扫描配置的文件夹
- **AND** 文件夹中无任何 Excel 文件
- **THEN** 系统显示「未找到可导入的文件」提示
- **AND** 提供「重新选择文件夹」选项

#### Scenario: 扫描文件数量过多
- **WHEN** 系统扫描到超过 10 个 Excel 文件
- **THEN** 系统仅显示前 10 个文件
- **AND** 提示「文件过多，建议整理文件夹」

---

### Requirement: 归档已完成的对账批次

系统应提供归档功能，将已完成的对账批次相关报告移动到归档文件夹。

#### Scenario: 首次归档未设置归档文件夹
- **WHEN** 用户点击「归档」按钮
- **AND** `archiveFolder` 未配置
- **THEN** 系统弹出归档文件夹选择对话框
- **AND** 用户选择后保存配置并继续归档

#### Scenario: 执行归档操作
- **WHEN** 用户点击「归档」按钮
- **AND** `archiveFolder` 已配置
- **AND** 批次状态为 `completed`
- **THEN** 系统在归档文件夹创建子目录 `YYYY-MM-DD_批次名称`
- **AND** 将批次相关报告文件复制到该目录
- **AND** 显示「归档成功」提示

#### Scenario: 非完成状态不可归档
- **WHEN** 用户查看对账详情页
- **AND** 批次状态不是 `completed`
- **THEN** 「归档」按钮不可点击或不显示
